<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.281">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>compmemlearn – likelihood_without_first_recall</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-light ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">compmemlearn</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- toc -->
    <nav id="TOC" role="doc-toc" class="sidebar sidebar-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#data-likelihood-without-first-recall" class="nav-link active" data-scroll-target="#data-likelihood-without-first-recall">Data Likelihood Without First Recall</a>
<ul class="collapse">
<li><a href="#likelihood-functions" class="nav-link" data-scroll-target="#likelihood-functions">Likelihood Functions</a></li>
<li><a href="#simulation-functions" class="nav-link" data-scroll-target="#simulation-functions">Simulation Functions</a></li>
<li><a href="#fitting-condition-1-of-lohnas-dataset-with-both-likelihood-functions" class="nav-link" data-scroll-target="#fitting-condition-1-of-lohnas-dataset-with-both-likelihood-functions">Fitting Condition 1 of Lohnas Dataset With Both Likelihood Functions</a>
<ul class="collapse">
<li><a href="#loading-and-optimizing-along-cost-function" class="nav-link" data-scroll-target="#loading-and-optimizing-along-cost-function">Loading and Optimizing Along Cost Function</a></li>
<li><a href="#lets-compare-this-result-with-what-wed-obtain-if-we-fit-using-murdock_data_likelihood." class="nav-link" data-scroll-target="#lets-compare-this-result-with-what-wed-obtain-if-we-fit-using-murdock_data_likelihood.">Let’s compare this result with what we’d obtain if we fit using <code>murdock_data_likelihood</code>.</a></li>
</ul></li>
<li><a href="#fitting-murdock-1970-dataset" class="nav-link" data-scroll-target="#fitting-murdock-1970-dataset">Fitting Murdock 1970 Dataset</a></li>
<li><a href="#fitting-to-mixed-lists-in-lohnas-2014-dataset" class="nav-link" data-scroll-target="#fitting-to-mixed-lists-in-lohnas-2014-dataset">Fitting to Mixed Lists in Lohnas 2014 Dataset</a>
<ul class="collapse">
<li><a href="#loading-and-optimizing-along-cost-function-1" class="nav-link" data-scroll-target="#loading-and-optimizing-along-cost-function-1">Loading and Optimizing Along Cost Function</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<!-- main -->
<main class="content">

<section id="data-likelihood-without-first-recall" class="level1">
<h1>Data Likelihood Without First Recall</h1>
<p>In the datasets I’ve considered, CMR often unique struggles to account for the first recall a subject makes in a trial. In likelihood-based fitting, this difficulty can throw off the parameter search process, driving the model to fail to adequately fit to other important phenomena such as the lag-contiguity and serial position effects.</p>
<p>We’ll demo some fitting and simulation code that treats the distribution of first recalls as static events, configuring parameter values and generating data for downstream analysis without weighting or varying it. This enables us to neatly examine the model’s ability to account for other features of datasets.</p>
<section id="likelihood-functions" class="level2">
<h2 class="anchored" data-anchor-id="likelihood-functions">Likelihood Functions</h2>
<p>Differences from original functions: - <code>likelihood</code> initialized with one fewer column since one less item is recalled - <code>likelihood</code> only populated with a value for events after <code>recall_index</code> 0 - column <code>recall_index-1</code> instead of <code>recall_index</code> is populated with each likelihood value since we skip 0.</p>
<p>Important commonalities: - First recall event is still simulated each time as in original function</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba <span class="im">import</span> njit, prange</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.models <span class="im">import</span> Classic_CMR</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba.typed <span class="im">import</span> Dict</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba.core <span class="im">import</span> types</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">@njit</span>(fastmath<span class="op">=</span><span class="va">True</span>, nogil<span class="op">=</span><span class="va">True</span>, parallel<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> murdock_data_likelihood(data_to_fit, item_counts, model_class, parameters):</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> prange(<span class="bu">len</span>(item_counts)):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        item_count <span class="op">=</span> item_counts[i]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        trials <span class="op">=</span> data_to_fit[i]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        likelihood <span class="op">=</span> np.ones((<span class="bu">len</span>(trials), item_count<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> model_class(item_count, item_count, parameters)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        model.experience(model.items)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> trial_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trials)):</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            trial <span class="op">=</span> trials[trial_index]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            model.force_recall()</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> recall_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trial) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># identify index of item recalled; if zero then recall is over</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> recall_index <span class="op">==</span> <span class="bu">len</span>(trial) <span class="kw">and</span> <span class="bu">len</span>(trial) <span class="op">&lt;</span> item_count:</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                    recall <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                    recall <span class="op">=</span> trial[recall_index]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                <span class="co"># store probability of and simulate recall of indexed item </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> recall_index <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                    likelihood[trial_index, recall_index<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                        model.outcome_probabilities()[recall] <span class="op">+</span> <span class="fl">10e-7</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> recall <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                model.force_recall(recall)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># reset model to its pre-retrieval (but post-encoding) state</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            model.force_recall(<span class="dv">0</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        result <span class="op">-=</span> np.<span class="bu">sum</span>(np.log(likelihood))</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> murdock_objective_function(data_to_fit, item_counts, model_class, fixed_parameters, free_parameters):</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">    Configures cmr_likelihood for search over specified free/fixed parameters.</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">=</span> Dict.empty(key_type<span class="op">=</span>types.unicode_type, value_type<span class="op">=</span>types.float64)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, value <span class="kw">in</span> fixed_parameters.items():</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        parameters[name] <span class="op">=</span> value</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective_function(x):</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(free_parameters)):</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>            parameters[free_parameters[i]] <span class="op">=</span> x[i]</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> murdock_data_likelihood(data_to_fit, item_counts, model_class, parameters)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> objective_function</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba <span class="im">import</span> njit, prange</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.models <span class="im">import</span> Classic_CMR</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba.typed <span class="im">import</span> Dict</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba.core <span class="im">import</span> types</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">@njit</span>(fastmath<span class="op">=</span><span class="va">True</span>, nogil<span class="op">=</span><span class="va">True</span>, parallel<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lohnas_data_likelihood(trials, presentations, model_class, parameters):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    list_length <span class="op">=</span> <span class="bu">len</span>(presentations[<span class="dv">0</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    likelihood <span class="op">=</span> np.ones((<span class="bu">len</span>(trials), list_length<span class="op">-</span><span class="dv">1</span>)) </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial_index <span class="kw">in</span> prange(<span class="bu">len</span>(trials)):</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        item_count <span class="op">=</span> np.<span class="bu">max</span>(presentations[trial_index])<span class="op">+</span><span class="dv">1</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        trial <span class="op">=</span> trials[trial_index]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> model_class(item_count, list_length, parameters)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        model.experience(model.items[presentations[trial_index]])</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        model.force_recall()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> recall_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trial) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># identify index of item recalled; if zero then recall is over</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> recall_index <span class="op">==</span> <span class="bu">len</span>(trial) <span class="kw">and</span> <span class="bu">len</span>(trial) <span class="op">&lt;</span> item_count:</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                recall <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> trial[recall_index] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                recall <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                recall <span class="op">=</span> presentations[trial_index][trial[recall_index]<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># store probability of and simulate recalling item with this index</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> recall_index <span class="op">&gt;</span> <span class="dv">0</span>:                        </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                likelihood[trial_index, recall_index<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                    model.outcome_probabilities()[recall] <span class="op">+</span> <span class="fl">10e-7</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> recall <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>            model.force_recall(recall)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reset model to its pre-retrieval (but post-encoding) state</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        model.force_recall(<span class="dv">0</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.<span class="bu">sum</span>(np.log(likelihood))</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lohnas_objective_function(data_to_fit, presentations, model_class, fixed_parameters, free_parameters):</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">    Generates and returns an objective function for input to support search </span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">    through parameter space for model fit using an optimization function.</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a function that accepts a vector x specifying arbitrary values for </span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">    free parameters and returns evaluation of likelihood using the model </span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">    class, all parameters, and provided data.</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">=</span> Dict.empty(key_type<span class="op">=</span>types.unicode_type, value_type<span class="op">=</span>types.float64)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, value <span class="kw">in</span> fixed_parameters.items():</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        parameters[name] <span class="op">=</span> value</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective_function(x):</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(free_parameters)):</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>            parameters[free_parameters[i]] <span class="op">=</span> x[i]</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lohnas_data_likelihood(data_to_fit, presentations, model_class, parameters)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> objective_function</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simulation-functions" class="level2">
<h2 class="anchored" data-anchor-id="simulation-functions">Simulation Functions</h2>
<p>We want to make sure we are always simulating the first recalls that correspond to the datasets we fit the model to. Using our <code>force_recall</code> function should make that work. We’ll add support for a <code>first_recall_item</code> array argument that identifies for each experiment trial a first recall to simulate. Like the values in our <code>trials</code> arrays, the values should be one-indexed.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> psifr <span class="im">import</span> fr</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba <span class="im">import</span> int32</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba <span class="im">import</span> njit</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_df(model, experiment_count, first_recall_item<span class="op">=</span>np.array([])):</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Initialize a model with specified parameters and experience sequences and </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    then populate a psifr-formatted dataframe with the outcomes of performing `free recall`. </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    **Required model attributes**:</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    - item_count: specifies number of items encoded into memory</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">    - context: vector representing an internal contextual state</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">    - experience: adding a new trace to the memory model</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">    - free_recall: function that freely recalls a given number of items or until recall stops</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># encode items</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    model.experience(model.items)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate retrieval for the specified number of times, tracking results in df</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    trial_count <span class="op">=</span> experiment_count</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> first_recall_item.size <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        trial_count <span class="op">=</span> experiment_count <span class="op">*</span> first_recall_item.size</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial_index <span class="kw">in</span> <span class="bu">range</span>(trial_count):</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        data <span class="op">+=</span> [[trial_index, <span class="dv">0</span>, <span class="st">'study'</span>, i <span class="op">+</span> <span class="dv">1</span>, i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model.item_count)]</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial_index <span class="kw">in</span> <span class="bu">range</span>(trial_count):</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> first_recall_item.size <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            experiment <span class="op">=</span> <span class="bu">int</span>(trial_index<span class="op">/</span>first_recall_item.size)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            model.force_recall(first_recall_item[trial_index <span class="op">-</span> (experiment <span class="op">*</span> first_recall_item.size)])</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        data <span class="op">+=</span> [[trial_index, <span class="dv">0</span>, <span class="st">'recall'</span>, i <span class="op">+</span> <span class="dv">1</span>, o] <span class="cf">for</span> i, o <span class="kw">in</span> <span class="bu">enumerate</span>(model.free_recall())]</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'subject'</span>, <span class="st">'list'</span>, <span class="st">'trial_type'</span>, <span class="st">'position'</span>, <span class="st">'item'</span>])</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> fr.merge_free_recall(data)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>simulate_data <span class="op">=</span> simulate_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">@njit</span>(fastmath<span class="op">=</span><span class="va">True</span>, nogil<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_array(model, experiment_count, first_recall_item<span class="op">=</span>np.array([])):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># encode items</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    model.experience(model.items)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate retrieval for the specified number of times, tracking results in array</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> first_recall_item.size <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        experiment_count <span class="op">*=</span> first_recall_item.size</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    trials <span class="op">=</span> np.zeros((experiment_count, <span class="bu">len</span>(model.items)), dtype<span class="op">=</span>int32)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trial_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trials)):</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> first_recall_item.size <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            experiment <span class="op">=</span> <span class="bu">int</span>(trial_index<span class="op">/</span>first_recall_item.size)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            model.force_recall(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                first_recall_item[trial_index <span class="op">-</span> (</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                    experiment <span class="op">*</span> first_recall_item.size)])</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        recalled <span class="op">=</span> model.free_recall()</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        trials[trial_index, :<span class="bu">len</span>(recalled)] <span class="op">=</span> recalled <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trials</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Need First Recall Item Argument to Identify Item Indices like Presentation Does and Like Trial Doesn't!</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">@njit</span>(nogil<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_array_from_presentations(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    model_class, parameters, presentations, experiment_count,  first_recall_item<span class="op">=</span>np.array([])):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate retrieval for the specified number of times, tracking results in trials array</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    trials <span class="op">=</span> np.zeros((experiment_count <span class="op">*</span> <span class="bu">len</span>(presentations), np.<span class="bu">max</span>(presentations)<span class="op">+</span><span class="dv">1</span>), dtype<span class="op">=</span>int32)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> experiment <span class="kw">in</span> <span class="bu">range</span>(experiment_count):</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> trial_index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(presentations)):</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># retrieve presentation sequence for this trial and measure number of unique items</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            presentation <span class="op">=</span> presentations[trial_index]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            item_count <span class="op">=</span> np.<span class="bu">max</span>(presentation)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># simulate recall and identify first study position of each recalled item</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> model_class(item_count, <span class="bu">len</span>(presentation), parameters)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            model.experience(model.items[presentation])</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> first_recall_item.size <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                model.force_recall(first_recall_item[trial_index])</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            recalled <span class="op">=</span> model.free_recall()</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(recalled)):</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                trials[experiment<span class="op">*</span><span class="bu">len</span>(presentations) <span class="op">+</span> trial_index, i] <span class="op">=</span> find_first(recalled[i], presentation) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trials</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="at">@njit</span>(nogil<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_first(item, vec):</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""return the index of the first occurence of item in vec"""</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(vec)):</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> item <span class="op">==</span> vec[i]:</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> i</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fitting-condition-1-of-lohnas-dataset-with-both-likelihood-functions" class="level2">
<h2 class="anchored" data-anchor-id="fitting-condition-1-of-lohnas-dataset-with-both-likelihood-functions">Fitting Condition 1 of Lohnas Dataset With Both Likelihood Functions</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.datasets <span class="im">import</span> prepare_murdock1962_data, prepare_murdock1970_data, prepare_lohnas2014_data</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>trials, events, list_length, presentations, list_types, rep_data, subjects <span class="op">=</span> prepare_lohnas2014_data(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/repFR.mat'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>free_parameters <span class="op">=</span> (</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'encoding_drift_rate'</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'start_drift_rate'</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'recall_drift_rate'</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'shared_support'</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'item_support'</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'primacy_scale'</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'primacy_decay'</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stop_probability_scale'</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stop_probability_growth'</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'choice_sensitivity'</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'delay_drift_rate'</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>lb <span class="op">=</span> np.finfo(<span class="bu">float</span>).eps</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>ub <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>np.finfo(<span class="bu">float</span>).eps</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> (</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">100</span>),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">100</span>),</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">10</span>),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">10</span>),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="at">@njit</span>(fastmath<span class="op">=</span><span class="va">True</span>, nogil<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_cmr(item_count, presentation_count, parameters):</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Classic_CMR(item_count, presentation_count, parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="loading-and-optimizing-along-cost-function" class="level3">
<h3 class="anchored" data-anchor-id="loading-and-optimizing-along-cost-function">Loading and Optimizing Along Cost Function</h3>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> differential_evolution</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cost function to be minimized</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ours scales inversely with the probability that the data could have been </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># generated using the specified parameters and our model</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>cost_function <span class="op">=</span> lohnas_objective_function(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    trials[list_types <span class="op">==</span> <span class="dv">1</span>], </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    presentations[list_types <span class="op">==</span> <span class="dv">1</span>], </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    init_cmr,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'sampling_rule'</span>: <span class="dv">0</span>, <span class="st">'mfc_familiarity_scale'</span>: <span class="dv">0</span>, <span class="st">'mcf_familiarity_scale'</span>: <span class="dv">0</span>, <span class="st">'drift_familiarity_scale'</span>: <span class="dv">0</span>}, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    free_parameters)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>lohnas_result <span class="op">=</span> differential_evolution(cost_function, bounds, disp<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lohnas_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>differential_evolution step 1: f(x)= 24877.6
differential_evolution step 2: f(x)= 22147
differential_evolution step 3: f(x)= 22147
differential_evolution step 4: f(x)= 21216.5
differential_evolution step 5: f(x)= 19343.9
differential_evolution step 6: f(x)= 19343.9
differential_evolution step 7: f(x)= 19343.9
differential_evolution step 8: f(x)= 19343.9
differential_evolution step 9: f(x)= 19343.9
differential_evolution step 10: f(x)= 19343.9
differential_evolution step 11: f(x)= 19343.9
differential_evolution step 12: f(x)= 19136.3
differential_evolution step 13: f(x)= 18672.3
differential_evolution step 14: f(x)= 17729.3
differential_evolution step 15: f(x)= 17729.3
differential_evolution step 16: f(x)= 17729.3
differential_evolution step 17: f(x)= 17729.3
differential_evolution step 18: f(x)= 17729.3
differential_evolution step 19: f(x)= 17729.3
differential_evolution step 20: f(x)= 17640
differential_evolution step 21: f(x)= 17640
differential_evolution step 22: f(x)= 17640
differential_evolution step 23: f(x)= 17640
differential_evolution step 24: f(x)= 17640
differential_evolution step 25: f(x)= 17640
differential_evolution step 26: f(x)= 17554.7
differential_evolution step 27: f(x)= 17554.7
differential_evolution step 28: f(x)= 17554.7
differential_evolution step 29: f(x)= 17554.7
differential_evolution step 30: f(x)= 17554.7
differential_evolution step 31: f(x)= 17513.6
differential_evolution step 32: f(x)= 17513.6
differential_evolution step 33: f(x)= 17513.6
differential_evolution step 34: f(x)= 17513.6
differential_evolution step 35: f(x)= 17505.4
differential_evolution step 36: f(x)= 17476.4
differential_evolution step 37: f(x)= 17455.2
differential_evolution step 38: f(x)= 17455.2
     fun: 17397.533835842947
     jac: array([-0.04147296, -0.00145519, -0.29613147,  0.02764864,  0.02510205,
        0.01418812,  0.00291038,  0.        , -0.15170372,  0.29067451,
       -0.12041709, -0.0003638 ])
 message: 'Optimization terminated successfully.'
    nfev: 9061
     nit: 38
 success: True
       x: array([7.55813076e-01, 7.89655494e-01, 9.23309281e-01, 7.99845601e-01,
       8.67256168e-01, 6.68956944e-01, 6.52056568e-01, 7.02569359e+01,
       2.57444793e-02, 8.70280471e-02, 1.00000000e+01, 2.21156982e-08])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.fitting <span class="im">import</span> apply_and_concatenate</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>fitted_parameters <span class="op">=</span> Dict.empty(key_type<span class="op">=</span>types.unicode_type, value_type<span class="op">=</span>types.float64)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(lohnas_result.x)):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    fitted_parameters[free_parameters[i]] <span class="op">=</span> lohnas_result.x[i]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'sampling_rule'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mfc_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mcf_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'drift_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>model0 <span class="op">=</span> Classic_CMR(<span class="dv">40</span>, <span class="dv">40</span>, fitted_parameters)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>sim_df0 <span class="op">=</span> simulate_df(model0, <span class="dv">2</span>, trials[list_types<span class="op">==</span><span class="dv">1</span>][:, <span class="dv">0</span>])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>true_df0 <span class="op">=</span> events.loc[events.condition<span class="op">==</span><span class="dv">1</span>]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>cmr_spc0 <span class="op">=</span> apply_and_concatenate(fr.spc, sim_df0, true_df0, contrast_name<span class="op">=</span><span class="st">'source'</span>, labels<span class="op">=</span>[<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>cmr_lag_crp0 <span class="op">=</span> apply_and_concatenate(fr.lag_crp, sim_df0, true_df0, <span class="st">'source'</span>, [<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>cmr_pfr0 <span class="op">=</span> apply_and_concatenate(fr.pnr, sim_df0, true_df0, contrast_name<span class="op">=</span><span class="st">'source'</span>, labels<span class="op">=</span>[<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>cmr_pfr0 <span class="op">=</span> cmr_pfr0.query(<span class="st">'output &lt;= 1'</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span><span class="op">/</span><span class="dv">3</span>), sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># serial position curve</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>cmr_spc0, x<span class="op">=</span><span class="st">'input'</span>, y<span class="op">=</span><span class="st">'recall'</span>, err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Study Position'</span>, ylabel<span class="op">=</span><span class="st">'Recall Rate'</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xticks(np.arange(<span class="dv">1</span>, list_length<span class="op">+</span><span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># lag CRP</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>max_lag <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>filt_neg <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span><span class="op">-</span>max_lag<span class="sc">}</span><span class="ss"> &lt;= lag &lt; 0'</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>filt_pos <span class="op">=</span> <span class="ss">f'0 &lt; lag &lt;= </span><span class="sc">{</span>max_lag<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>cmr_lag_crp0.query(filt_neg), x<span class="op">=</span><span class="st">'lag'</span>, y<span class="op">=</span><span class="st">'prob'</span>, </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>             err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>cmr_lag_crp0.query(filt_pos), x<span class="op">=</span><span class="st">'lag'</span>, y<span class="op">=</span><span class="st">'prob'</span>, </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>             err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Lag From Last Recalled Item'</span>, ylabel<span class="op">=</span><span class="st">'Conditional Recall Rate'</span>)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xticks(np.arange(<span class="op">-</span><span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co"># pfr</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>cmr_pfr0, x<span class="op">=</span><span class="st">'input'</span>, y<span class="op">=</span><span class="st">'prob'</span>, err_style<span class="op">=</span><span class="st">'bars'</span>, ax<span class="op">=</span>axes[<span class="dv">2</span>], hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Study Position'</span>, ylabel<span class="op">=</span><span class="st">'Probability of First Recall'</span>)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xticks(np.arange(<span class="dv">1</span>, list_length<span class="op">+</span><span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co"># set legend of axis 2 outside the plot, to the right</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="dv">2</span>, borderaxespad<span class="op">=</span><span class="fl">0.</span>)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Likelihood_Without_First_Recall_files\figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="lets-compare-this-result-with-what-wed-obtain-if-we-fit-using-murdock_data_likelihood." class="level3">
<h3 class="anchored" data-anchor-id="lets-compare-this-result-with-what-wed-obtain-if-we-fit-using-murdock_data_likelihood.">Let’s compare this result with what we’d obtain if we fit using <code>murdock_data_likelihood</code>.</h3>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> differential_evolution</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cost function to be minimized</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ours scales inversely with the probability that the data could have been </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># generated using the specified parameters and our model</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>cost_function <span class="op">=</span> murdock_objective_function(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    (trials[list_types<span class="op">==</span><span class="dv">1</span>], ), </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">40</span>, ), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    init_cmr,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'sampling_rule'</span>: <span class="dv">0</span>, <span class="st">'mfc_familiarity_scale'</span>: <span class="dv">0</span>, <span class="st">'mcf_familiarity_scale'</span>: <span class="dv">0</span>, <span class="st">'drift_familiarity_scale'</span>: <span class="dv">0</span>}, </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    free_parameters)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>murdock_result <span class="op">=</span> differential_evolution(cost_function, bounds, disp<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murdock_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>differential_evolution step 1: f(x)= 20429.6
differential_evolution step 2: f(x)= 20429.6
differential_evolution step 3: f(x)= 19671.6
differential_evolution step 4: f(x)= 19319
differential_evolution step 5: f(x)= 19319
differential_evolution step 6: f(x)= 19202.3
differential_evolution step 7: f(x)= 18877.5
differential_evolution step 8: f(x)= 18877.5
differential_evolution step 9: f(x)= 18366.8
differential_evolution step 10: f(x)= 18152.5
differential_evolution step 11: f(x)= 18152.5
differential_evolution step 12: f(x)= 18152.5
differential_evolution step 13: f(x)= 18009.6
differential_evolution step 14: f(x)= 18009.6
differential_evolution step 15: f(x)= 18009.6
differential_evolution step 16: f(x)= 17965.1
differential_evolution step 17: f(x)= 17557.8
differential_evolution step 18: f(x)= 17557.8
differential_evolution step 19: f(x)= 17557.8
differential_evolution step 20: f(x)= 17557.8
differential_evolution step 21: f(x)= 17504.4
differential_evolution step 22: f(x)= 17504.4
differential_evolution step 23: f(x)= 17504.4
differential_evolution step 24: f(x)= 17484.2
differential_evolution step 25: f(x)= 17477.3
differential_evolution step 26: f(x)= 17477.3
differential_evolution step 27: f(x)= 17473.9
differential_evolution step 28: f(x)= 17469.3
differential_evolution step 29: f(x)= 17469.3
differential_evolution step 30: f(x)= 17457.9
     fun: 17397.533842605546
     jac: array([-0.19354047, -0.01964509,  0.12551027, -0.16007107, -0.01928129,
       -0.04292815, -0.00836735,  0.        , -0.61700121,  0.14224497,
       -0.09640643,  0.        ])
 message: 'Optimization terminated successfully.'
    nfev: 7998
     nit: 30
 success: True
       x: array([7.55826965e-01, 7.89320574e-01, 9.23286854e-01, 7.99614742e-01,
       8.65995433e-01, 6.69516249e-01, 6.51724781e-01, 4.70748465e+01,
       2.57434103e-02, 8.70291613e-02, 1.00000000e+01, 2.22044605e-16])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.fitting <span class="im">import</span> apply_and_concatenate</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fitted_parameters <span class="op">=</span> Dict.empty(key_type<span class="op">=</span>types.unicode_type, value_type<span class="op">=</span>types.float64)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(murdock_result.x)):</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    fitted_parameters[free_parameters[i]] <span class="op">=</span> murdock_result.x[i]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'sampling_rule'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mfc_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mcf_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'drift_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>model0 <span class="op">=</span> Classic_CMR(<span class="dv">40</span>, <span class="dv">40</span>, fitted_parameters)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>sim_df0 <span class="op">=</span> simulate_df(model0, <span class="dv">3</span>, trials[list_types<span class="op">==</span><span class="dv">1</span>][:, <span class="dv">0</span>])</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>true_df0 <span class="op">=</span> events.loc[events.condition<span class="op">==</span><span class="dv">1</span>]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>cmr_spc0 <span class="op">=</span> apply_and_concatenate(fr.spc, sim_df0, true_df0, contrast_name<span class="op">=</span><span class="st">'source'</span>, labels<span class="op">=</span>[<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>cmr_lag_crp0 <span class="op">=</span> apply_and_concatenate(fr.lag_crp, sim_df0, true_df0, <span class="st">'source'</span>, [<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>cmr_pfr0 <span class="op">=</span> apply_and_concatenate(fr.pnr, sim_df0, true_df0, contrast_name<span class="op">=</span><span class="st">'source'</span>, labels<span class="op">=</span>[<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>cmr_pfr0 <span class="op">=</span> cmr_pfr0.query(<span class="st">'output &lt;= 1'</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span><span class="op">/</span><span class="dv">3</span>), sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># serial position curve</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>cmr_spc0, x<span class="op">=</span><span class="st">'input'</span>, y<span class="op">=</span><span class="st">'recall'</span>, err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Study Position'</span>, ylabel<span class="op">=</span><span class="st">'Recall Rate'</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xticks(np.arange(<span class="dv">1</span>, list_length<span class="op">+</span><span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># lag CRP</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>max_lag <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>filt_neg <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span><span class="op">-</span>max_lag<span class="sc">}</span><span class="ss"> &lt;= lag &lt; 0'</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>filt_pos <span class="op">=</span> <span class="ss">f'0 &lt; lag &lt;= </span><span class="sc">{</span>max_lag<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>cmr_lag_crp0.query(filt_neg), x<span class="op">=</span><span class="st">'lag'</span>, y<span class="op">=</span><span class="st">'prob'</span>, </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>             err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>cmr_lag_crp0.query(filt_pos), x<span class="op">=</span><span class="st">'lag'</span>, y<span class="op">=</span><span class="st">'prob'</span>, </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>             err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Lag From Last Recalled Item'</span>, ylabel<span class="op">=</span><span class="st">'Conditional Recall Rate'</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xticks(np.arange(<span class="op">-</span><span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>))</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co"># pfr</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>cmr_pfr0, x<span class="op">=</span><span class="st">'input'</span>, y<span class="op">=</span><span class="st">'prob'</span>, err_style<span class="op">=</span><span class="st">'bars'</span>, ax<span class="op">=</span>axes[<span class="dv">2</span>], hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Study Position'</span>, ylabel<span class="op">=</span><span class="st">'Probability of First Recall'</span>)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xticks(np.arange(<span class="dv">1</span>, list_length<span class="op">+</span><span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co"># set legend of axis 2 outside the plot, to the right</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="dv">2</span>, borderaxespad<span class="op">=</span><span class="fl">0.</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Likelihood_Without_First_Recall_files\figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="fitting-murdock-1970-dataset" class="level2">
<h2 class="anchored" data-anchor-id="fitting-murdock-1970-dataset">Fitting Murdock 1970 Dataset</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>trials, events, list_length <span class="op">=</span> prepare_murdock1970_data(<span class="st">'../data/mo1970.txt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cost_function <span class="op">=</span> murdock_objective_function(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    (trials, ),  </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    (list_length, ),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    init_cmr,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'sampling_rule'</span>: <span class="dv">0</span>, <span class="st">'mfc_familiarity_scale'</span>: <span class="dv">0</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>     <span class="st">'mcf_familiarity_scale'</span>: <span class="dv">0</span>, <span class="st">'drift_familiarity_scale'</span>: <span class="dv">0</span>}, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    free_parameters)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>murdock_result <span class="op">=</span> differential_evolution(cost_function, bounds, disp<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>differential_evolution step 1: f(x)= 24214.4
differential_evolution step 2: f(x)= 24214.4
differential_evolution step 3: f(x)= 23360.6
differential_evolution step 4: f(x)= 21132
differential_evolution step 5: f(x)= 20786.5
differential_evolution step 6: f(x)= 20786.5
differential_evolution step 7: f(x)= 20786.5
differential_evolution step 8: f(x)= 20786.5
differential_evolution step 9: f(x)= 20786.5
differential_evolution step 10: f(x)= 20512.7
differential_evolution step 11: f(x)= 20113
differential_evolution step 12: f(x)= 20113
differential_evolution step 13: f(x)= 20113
differential_evolution step 14: f(x)= 19287.5
differential_evolution step 15: f(x)= 19287.5
differential_evolution step 16: f(x)= 19287.5
differential_evolution step 17: f(x)= 19287.5
differential_evolution step 18: f(x)= 19287.5
differential_evolution step 19: f(x)= 19287.5
differential_evolution step 20: f(x)= 19287.5
differential_evolution step 21: f(x)= 19226.1
differential_evolution step 22: f(x)= 19226.1
differential_evolution step 23: f(x)= 19226.1
differential_evolution step 24: f(x)= 19165.9
differential_evolution step 25: f(x)= 19165.9
differential_evolution step 26: f(x)= 19150.1
differential_evolution step 27: f(x)= 19150.1
differential_evolution step 28: f(x)= 19150.1
differential_evolution step 29: f(x)= 19144.4
differential_evolution step 30: f(x)= 19088
differential_evolution step 31: f(x)= 19088
differential_evolution step 32: f(x)= 19088
differential_evolution step 33: f(x)= 19088
differential_evolution step 34: f(x)= 19088
differential_evolution step 35: f(x)= 18999.6
differential_evolution step 36: f(x)= 18946.9
differential_evolution step 37: f(x)= 18946.9
differential_evolution step 38: f(x)= 18946.9
differential_evolution step 39: f(x)= 18946.9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.fitting <span class="im">import</span> apply_and_concatenate</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>fitted_parameters <span class="op">=</span> Dict.empty(key_type<span class="op">=</span>types.unicode_type, value_type<span class="op">=</span>types.float64)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(murdock_result.x)):</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    fitted_parameters[free_parameters[i]] <span class="op">=</span> murdock_result.x[i]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'sampling_rule'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mfc_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mcf_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'drift_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>model0 <span class="op">=</span> Classic_CMR(<span class="dv">20</span>, <span class="dv">20</span>, fitted_parameters)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>sim_df0 <span class="op">=</span> simulate_df(model0, <span class="dv">3</span>, trials[:, <span class="dv">0</span>])</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>true_df0 <span class="op">=</span> events</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>cmr_spc0 <span class="op">=</span> apply_and_concatenate(fr.spc, sim_df0, true_df0, contrast_name<span class="op">=</span><span class="st">'source'</span>, labels<span class="op">=</span>[<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>cmr_lag_crp0 <span class="op">=</span> apply_and_concatenate(fr.lag_crp, sim_df0, true_df0, <span class="st">'source'</span>, [<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>cmr_pfr0 <span class="op">=</span> apply_and_concatenate(fr.pnr, sim_df0, true_df0, contrast_name<span class="op">=</span><span class="st">'source'</span>, labels<span class="op">=</span>[<span class="st">'PrototypeCMR'</span>, <span class="st">'data'</span>])</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>cmr_pfr0 <span class="op">=</span> cmr_pfr0.query(<span class="st">'output &lt;= 1'</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span><span class="op">/</span><span class="dv">3</span>), sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># serial position curve</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>cmr_spc0, x<span class="op">=</span><span class="st">'input'</span>, y<span class="op">=</span><span class="st">'recall'</span>, err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Study Position'</span>, ylabel<span class="op">=</span><span class="st">'Recall Rate'</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xticks(np.arange(<span class="dv">1</span>, list_length<span class="op">+</span><span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># lag CRP</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>max_lag <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>filt_neg <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span><span class="op">-</span>max_lag<span class="sc">}</span><span class="ss"> &lt;= lag &lt; 0'</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>filt_pos <span class="op">=</span> <span class="ss">f'0 &lt; lag &lt;= </span><span class="sc">{</span>max_lag<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>cmr_lag_crp0.query(filt_neg), x<span class="op">=</span><span class="st">'lag'</span>, y<span class="op">=</span><span class="st">'prob'</span>, </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>             err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>cmr_lag_crp0.query(filt_pos), x<span class="op">=</span><span class="st">'lag'</span>, y<span class="op">=</span><span class="st">'prob'</span>, </span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>             err_style<span class="op">=</span><span class="st">'bars'</span>, hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Lag From Last Recalled Item'</span>, ylabel<span class="op">=</span><span class="st">'Conditional Recall Rate'</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xticks(np.arange(<span class="op">-</span><span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>))</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co"># pfr</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>cmr_pfr0, x<span class="op">=</span><span class="st">'input'</span>, y<span class="op">=</span><span class="st">'prob'</span>, err_style<span class="op">=</span><span class="st">'bars'</span>, ax<span class="op">=</span>axes[<span class="dv">2</span>], hue<span class="op">=</span><span class="st">'source'</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Study Position'</span>, ylabel<span class="op">=</span><span class="st">'Probability of First Recall'</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xticks(np.arange(<span class="dv">1</span>, list_length<span class="op">+</span><span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylim((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="co"># set legend of axis 2 outside the plot, to the right</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="dv">2</span>, borderaxespad<span class="op">=</span><span class="fl">0.</span>)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Likelihood_Without_First_Recall_files\figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="fitting-to-mixed-lists-in-lohnas-2014-dataset" class="level2">
<h2 class="anchored" data-anchor-id="fitting-to-mixed-lists-in-lohnas-2014-dataset">Fitting to Mixed Lists in Lohnas 2014 Dataset</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>trials, events, list_length, presentations, list_types, rep_data, subjects <span class="op">=</span> prepare_lohnas2014_data(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/repFR.mat'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>free_parameters <span class="op">=</span> (</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'encoding_drift_rate'</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'start_drift_rate'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'recall_drift_rate'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'shared_support'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'item_support'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'primacy_scale'</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'primacy_decay'</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stop_probability_scale'</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stop_probability_growth'</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'choice_sensitivity'</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'delay_drift_rate'</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'drift_familiarity_scale'</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>lb <span class="op">=</span> np.finfo(<span class="bu">float</span>).eps</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>ub <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>np.finfo(<span class="bu">float</span>).eps</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> (</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">100</span>),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">100</span>),</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">10</span>),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    (lb, <span class="dv">10</span>),</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    (lb, ub),</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    (lb, ub)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="loading-and-optimizing-along-cost-function-1" class="level3">
<h3 class="anchored" data-anchor-id="loading-and-optimizing-along-cost-function-1">Loading and Optimizing Along Cost Function</h3>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> differential_evolution</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cost function to be minimized</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ours scales inversely with the probability that the data could have been </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># generated using the specified parameters and our model</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>cost_function <span class="op">=</span> lohnas_objective_function(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    trials[list_types <span class="op">==</span> <span class="dv">4</span>], </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    presentations[list_types <span class="op">==</span> <span class="dv">4</span>], </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    init_cmr,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'sampling_rule'</span>: <span class="dv">0</span>, <span class="st">'mfc_familiarity_scale'</span>: <span class="dv">0</span>, <span class="st">'mcf_familiarity_scale'</span>: <span class="dv">0</span>}, </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    free_parameters)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>lohnas_result <span class="op">=</span> differential_evolution(cost_function, bounds, disp<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lohnas_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>differential_evolution step 1: f(x)= 20682.8
differential_evolution step 2: f(x)= 20682.8
differential_evolution step 3: f(x)= 18603.6
differential_evolution step 4: f(x)= 18603.6
differential_evolution step 5: f(x)= 18274.4
differential_evolution step 6: f(x)= 18274.4
differential_evolution step 7: f(x)= 18274.4
differential_evolution step 8: f(x)= 18247.6
differential_evolution step 9: f(x)= 17450.5
differential_evolution step 10: f(x)= 17450.5
differential_evolution step 11: f(x)= 17450.5
differential_evolution step 12: f(x)= 17450.5
differential_evolution step 13: f(x)= 17450.5
differential_evolution step 14: f(x)= 17044.4
differential_evolution step 15: f(x)= 17044.4
differential_evolution step 16: f(x)= 17044.4
differential_evolution step 17: f(x)= 16604.4
differential_evolution step 18: f(x)= 16485.7
differential_evolution step 19: f(x)= 16133.2
differential_evolution step 20: f(x)= 16133.2
differential_evolution step 21: f(x)= 16133.2
differential_evolution step 22: f(x)= 16133.2
differential_evolution step 23: f(x)= 16119.4
differential_evolution step 24: f(x)= 16079.8
differential_evolution step 25: f(x)= 16079.8
differential_evolution step 26: f(x)= 16079.8
differential_evolution step 27: f(x)= 15993.2
differential_evolution step 28: f(x)= 15971.1
differential_evolution step 29: f(x)= 15971.1
differential_evolution step 30: f(x)= 15961.6
differential_evolution step 31: f(x)= 15912
differential_evolution step 32: f(x)= 15912
differential_evolution step 33: f(x)= 15912
differential_evolution step 34: f(x)= 15912
differential_evolution step 35: f(x)= 15888.3
differential_evolution step 36: f(x)= 15888.3
differential_evolution step 37: f(x)= 15888.3
differential_evolution step 38: f(x)= 15876.2
differential_evolution step 39: f(x)= 15876.2
differential_evolution step 40: f(x)= 15876.2
differential_evolution step 41: f(x)= 15876.2
differential_evolution step 42: f(x)= 15876.2
differential_evolution step 43: f(x)= 15876.2
differential_evolution step 44: f(x)= 15876.2
differential_evolution step 45: f(x)= 15876.2
differential_evolution step 46: f(x)= 15876.2
differential_evolution step 47: f(x)= 15876.2
differential_evolution step 48: f(x)= 15876.2
differential_evolution step 49: f(x)= 15876.2
differential_evolution step 50: f(x)= 15876.2
differential_evolution step 51: f(x)= 15876.2
     fun: 15765.037256539877
     jac: array([-1.83063093,  0.54260454,  0.19463187,  1.2352757 ,  0.08876668,
       -0.72850526,  0.01182343,  0.134969  ,  0.94041752,  0.35233825,
       -0.25684131,  0.83782652, -0.00527507])
 message: 'Optimization terminated successfully.'
    nfev: 14186
     nit: 51
 success: True
       x: array([0.88669978, 0.11887846, 0.94681617, 0.04760541, 0.88864142,
       0.04585966, 5.17172382, 8.00427889, 0.02249963, 0.10413299,
       1.51616036, 0.99879117, 0.5847791 ])</code></pre>
</div>
</div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> compmemlearn.analyses <span class="im">import</span> fast_rpl</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>fitted_parameters <span class="op">=</span> Dict.empty(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    key_type<span class="op">=</span>types.unicode_type, value_type<span class="op">=</span>types.float64)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(lohnas_result.x)):</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    fitted_parameters[free_parameters[j]] <span class="op">=</span> lohnas_result.x[j]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'sampling_rule'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mfc_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'mcf_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>fitted_parameters[<span class="st">'drift_familiarity_scale'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>experiment_count <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>new_sim_array <span class="op">=</span> simulate_array_from_presentations(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    init_cmr, fitted_parameters, presentations[list_types<span class="op">==</span><span class="dv">4</span>], </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    experiment_count, trials[list_types<span class="op">==</span><span class="dv">4</span>][:, <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.matlib</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> fast_rpl(np.matlib.repmat(presentations[list_types<span class="op">==</span><span class="dv">4</span>], experiment_count, <span class="dv">1</span>), new_sim_array)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>binned <span class="op">=</span> np.zeros(<span class="dv">5</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">0</span>] <span class="op">=</span> result[<span class="dv">0</span>]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">1</span>] <span class="op">=</span> result[<span class="dv">1</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">2</span>] <span class="op">=</span> (result[<span class="dv">2</span>] <span class="op">+</span> result[<span class="dv">3</span>])<span class="op">/</span><span class="dv">2</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">3</span>] <span class="op">=</span> (result[<span class="dv">4</span>] <span class="op">+</span> result[<span class="dv">5</span>] <span class="op">+</span> result[<span class="dv">6</span>])<span class="op">/</span><span class="dv">3</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">4</span>] <span class="op">=</span> (result[<span class="dv">7</span>] <span class="op">+</span> result[<span class="dv">8</span>] <span class="op">+</span> result[<span class="dv">9</span>])<span class="op">/</span><span class="dv">3</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(binned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>fit_sources <span class="op">=</span> [<span class="st">'lohnas_4'</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>fit_rpls <span class="op">=</span> [binned]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(fit_sources)):</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    plt.plot(fit_rpls[i], label<span class="op">=</span>fit_sources[i])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> fast_rpl(presentations[list_types<span class="op">==</span><span class="dv">4</span>], trials[list_types<span class="op">==</span><span class="dv">4</span>])</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>binned <span class="op">=</span> np.zeros(<span class="dv">5</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">0</span>] <span class="op">=</span> result[<span class="dv">0</span>]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">1</span>] <span class="op">=</span> result[<span class="dv">1</span>]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">2</span>] <span class="op">=</span> (result[<span class="dv">2</span>] <span class="op">+</span> result[<span class="dv">3</span>])<span class="op">/</span><span class="dv">2</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">3</span>] <span class="op">=</span> (result[<span class="dv">4</span>] <span class="op">+</span> result[<span class="dv">5</span>] <span class="op">+</span> result[<span class="dv">6</span>])<span class="op">/</span><span class="dv">3</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>binned[<span class="dv">4</span>] <span class="op">=</span> (result[<span class="dv">7</span>] <span class="op">+</span> result[<span class="dv">8</span>] <span class="op">+</span> result[<span class="dv">9</span>])<span class="op">/</span><span class="dv">3</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>plt.plot(binned, label<span class="op">=</span><span class="st">'data'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>lags <span class="op">=</span> [<span class="st">'N/A'</span>, <span class="st">'0'</span>, <span class="st">'1-2'</span>, <span class="st">'3-5'</span>, <span class="st">'6-8'</span>]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="bu">len</span>(lags)), lags)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="dv">2</span>, borderaxespad<span class="op">=</span><span class="fl">0.</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</main> <!-- /main -->
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->


</body></html>